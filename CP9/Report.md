# Отчет по Курсовому проекту № 9
## по курсу "Практикум программирования"

Студент группы М8О-108Б-23 Соловьева Надежда Сергеевна

Работа выполнена 

Преподаватель: каф. 806 Севастьянов Виктор Сергеевич

1. **Тема**: Сортировка и поиск.  
2. **Цель работы**: Составить программу на Си с использованием процедур и функций для сортировки таблицы заданным методом и двоичного поиска по ключу.   
3. **Задание (Вариант №):** Вариант 7 - 7:  
     * **Метод сортировки**: Метод Шелла  
     * **Тип ключа/длина в байтах/хранение данных и ключей/число элементов таблицы**: комбинированный (целое+литера)/5/отдельно/8-12   
4. **Алгоритм решения:**  
     *Для раздельного хранения ключей и значений организованы структуры Key и Val.*  
     Программа считывает таблицу из текстового файла *output.txt*, содержащую ключи и строки ASCII графики, и преобразовывает значения в структуры и записывает их в виде массива однородных структур.
     Далее программа запрашивает у пользователя действие: 1. Распечатать таблицу, 2. Двоичный поиск по ключу, 3. Сортировка по ключу, 4. Перемешать строки таблицы, 5. Сделать реверс таблицы, 6. Выйти из программы. Дальнейшие действия выполняются в соответствии с вводом пользователя и осуществляются с помощью следующих функций.  

     **Функции:**  
     * *printTable()*: Функция для печати таблицы. Она проходится по каждому элементу массивов ключей и значения и выводит их в нужном формате.  
     * *binSearch()*:  Функция для бинарного поиска по ключу. На каждой итерации алгоритма массив делится пополам, и проверяется элемент в середине массива. Если этот элемент равен ключу, который мы ищем, то возвращается его индекс. В противном случае, если элемент меньше ключа, поиск осуществляется в правой половине массива, иначе - в левой половине. Этот процесс повторяется до тех пор, пока не будет найден элемент или пока левая граница не станет больше правой, что означает, что элемент не найден.
        * *isEqualKeys()*: Функция проверкии равенства двух ключей.  
        * *comparator()*: Функция сравнения двух ключей.
        * *isSorted()*: Функция проверки массива ключей на отсортированность.  
     * *sort()*: Функция сортировки ключей методом Шелла. Основная идея заключается в разделении массива на группы и сортировке элементов в каждой группе с определенным шагом (gap), который затем уменьшается до 1, чтобы выполнить окончательную сортировку. Внешний цикл устанливает начальное значение шага gap равным половине размера массива size и уменьшает его вдвое на каждой итерации, пока gap не станет равным 0. Внутренний цикл начинается с индекса gap и повторяется до конца массива. На каждой итерации внутреннего цикла текущий элемент с индексом i сравнивается с элементами, расположенными на расстоянии gap от него (с индексами j - gap), пока не будет найден правильный порядок для текущего элемента. В случае необходимости происходит сдвиг элементов на шаг равный gap. В итоге элементы сортируются в соответствии с заданным компаратором и размещаются на своих местах в массивах ключей и значений.
     * *scramble()*: Функция для перемешивания строк таблицы. Она перемешивает значения в массиве ключей и значениях случайным образом, применяя случайную перестановку.
        * *randomAB()*: Функция генерации случайного числа в диапазоне от a до b.
        * *swapRows()*: Функция замена мест двух строк массива ключей и соответствующих им значений.  
     * *reverse()*: Функция для вывода таблицы в обратном порядке.  
      
6. **Тестовые данные:**  

    *см. в Листинге работы*  

7. **Протокол**:
    Программа вывода на Си: [test.c](/test.c)  
   *Оценка по времени: O(n^2) - худший случай / O(n^(3/2)) - в среднем*  
   *Оценка по памяти: O(1)* 
  ```
    #include <stdio.h>
    #include <stdlib.h>
    #include <string.h>
    #include <time.h>
    
    typedef struct _Key
    {
        char key_word[6];
    } Key;
    
    typedef struct _Val
    {
        char val[81];
    } Val;
    
    void printTable(const Key *k, const Val *v, const int size);
    int binSearch(const Key *k, const Val *v, const int size, const Key key);
    void sort(Key *k, Val *v, const int size);
    void scramble(Key *k, Val *v, const int size);
    void reverse(Key *k, Val *v, const int size);
    
    void getRow(FILE *stream, char *str, const int size);
    void swapRows(Key *k, Val *v, const int a, const int b);
    int comparator(const Key k1, const Key k2);
    int isEqualKeys(const Key k1, const Key k2);
    int randomAB(const int a, const int b);
    int isSorted(const Key *k, const int size);
    
    int main(void)
    {
        const int N = 50;
        int i, cnt, action;
        
        Key keys[N];
        Val values[N];
        Key key;
        FILE *file = fopen("input.txt", "r");
    
        if (file == NULL)
        {
            printf("Ошибка при открытии файла\n");
            return 0;
        }
    
        i = 0;
    
        while (i < N && fscanf(file, "%5s", keys[i].key_word) == 1 && fgets(values[i].val, sizeof(values[i].val), file))
        {
            i++;
        }
    
        fclose(file);
        cnt = i;
    
        do
        {
            printf("Меню\n");
            printf("1) Печать\n");
            printf("2) Бинарный поиск\n");
            printf("3) Сортировка\n");
            printf("4) Перемешивание\n");
            printf("5) Реверс\n");
            printf("6) Выход\n");
            printf("Выберите действие\n");
            scanf("%d", &action);
    
            switch (action)
            {
                case 1:
                {
                    printTable(keys, values, cnt);
                    break;
                }
    
                case 2:
                {
                    if (!isSorted(keys, cnt))
                        printf("Ошибка. Таблица не отсортирована\n");
                    else
                    {
                        printf("Введите ключ: ");
                        scanf("%5s", key.key_word);
    
                        i = binSearch(keys, values, cnt, key);
    
                        if (i > -1)
                            printf("Найдена строка: %s\n", values[i].val);
                        else
                            printf("Строка с таким ключом не найдена\n");
                    }
                    break;
                }
    
                case 3:
                {
                    sort(keys, values, cnt);
                    break;
                }
    
                case 4:
                {
                    scramble(keys, values, cnt);
                    break;
                }
    
                case 5:
                {
                    reverse(keys, values, cnt);
                    break;
                }
    
                case 6:
                    break;
    
                default:
                {
                    printf("Ошибка. Такого пункта меню не существует\n");
                    break;
                }
            }
        }
        while (action != 6);
    
        return 0;
    }
    
    void printTable(const Key *k, const Val *v, const int size)
    {
        int i;
        printf("+-------+----------------------------------------------------------------------------------+\n");
        printf("|  Ключ |                          Значение                                                |\n");
        printf("+-------+----------------------------------------------------------------------------------+\n");
    
        for (i = 0; i < size; i++)
            printf("| %5s |%60s\n", k[i].key_word, v[i].val);
    
        printf("+-------+----------------------------------------------------------------------------------+\n");
    }
    
    int binSearch(const Key *k, const Val *v, const int size, const Key key)
    {
        int start = 0, end = size - 1, mid;
    
        if (size <= 0)
            return -1;
    
        while (start <= end)
        {
            mid = start + (end - start) / 2;
    
            if (isEqualKeys(k[mid], key))
                return mid;
            else if (comparator(k[mid], key))
                start = mid + 1;
            else
                end = mid - 1;
        }
    
        return -1;
    }
    
    void sort(Key *k, Val *v, const int size)
    {
        int gap, i, j;
        Key keyTemp;
        Val valTemp;
    
        for (gap = size / 2; gap > 0; gap /= 2)
        {
            for (i = gap; i < size; i++)
            {
                keyTemp = k[i];
                valTemp = v[i];
                j = i;
    
                while (j >= gap && comparator(k[j - gap], keyTemp) > 0)
                {
                    k[j] = k[j - gap];
                    v[j] = v[j - gap];
                    j -= gap;
                }
    
                k[j] = keyTemp;
                v[j] = valTemp;
            }
        }
    }
    
    void reverse(Key *k, Val *v, const int size)
    {
        int i, j;
        for (i = 0, j = size - 1; i < j; i++, j--)
        {
            swapRows(k, v, i, j);
        }
    }
    
    void scramble(Key *k, Val *v, const int size)
    {
        int i;
        for (i = size - 1; i > 0; i--)
        {
            int j = randomAB(0, i);
            swapRows(k, v, i, j);
        }
    }
    
    void getRow(FILE *stream, char *str, const int size)
    {
        int cnt = 0, ch;
    
        while ((ch = getc(stream)) != '\n' && cnt < size - 1)
            str[cnt++] = ch;
    
        str[cnt] = '\0';
    }
    
    void swapRows(Key *k, Val *v, const int a, const int b)
    {
        Key tmpKey;
        Val tmpVal;
    
        tmpKey = k[a];
        k[a] = k[b];
        k[b] = tmpKey;
    
        tmpVal = v[a];
        v[a] = v[b];
        v[b] = tmpVal;
    }
    
    
    int comparator(const Key k1, const Key k2)
    {
        return strcmp(k1.key_word, k2.key_word);
    }
    
    int isEqualKeys(const Key k1, const Key k2)
    {
        return strcmp(k1.key_word, k2.key_word) == 0;
    }
    
    int randomAB(const int a, const int b)
    {
        return a + rand() % (b - a + 1);
    }
    
    int isSorted(const Key *k, const int size)
    {
        int i;
    
        for (i = 0; i < size - 1; i++)
            if (comparator(k[i], k[i + 1]) != -1)
                return 0;
    
        return 1;
    }
  ```
 
7. **Листинг:**
```
hopeee@hopeeenad:~/repository/Lab/CP9$ valgrind --leak-check=full ./test
==48388== Memcheck, a memory error detector
==48388== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.
==48388== Using Valgrind-3.18.1 and LibVEX; rerun with -h for copyright info
==48388== Command: ./test
==48388==
Меню
1) Печать
2) Бинарный поиск
3) Сортировка
4) Перемешивание
5) Реверс
6) Выход
Выберите действие
1
+-------+----------------------------------------------------------------------------------+
|  Ключ |                          Значение                                                |
+-------+----------------------------------------------------------------------------------+
|  10ab |                                  #,

| 11bcc |                                 ###

|   12c |                                ## ##

|   13d |                               ##  ##

|   14e |                                ####

|   15f |                                  :

|   16g |                                 #####

|   17h |                                ######

|   18i |                                ##  ##

|   19j |                                ##  ##

|   20k |                                ##  ##

|   21l |                                ##  ##########

|   22m |                                ##  #############

|   23n |                           #######  ###############

|   24o |                       #############################

|   25p |                 .###################################

|   26q |                #####################################;

|   27r |                ##                                 ##.

|   28s |                ##                                 ##

|   29t |                #####################################

|   30u |                ##                                 ##

|   31v |                ##                                 ##

|   32w |                ##                                 ###

|   33x |             #####                                 #####

|   34y |            ### ##################################### ###

|   35z |           ###  ##                                 ##  ###

|   36a |           ##   ## ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,, ##   ##

|   37b |            ##  #####################################  ##

|   38c |             ##                                       ##

|   39d |              ####                                 ####

|   40e |                ######                         ######

|   41f |                     ###############################
+-------+----------------------------------------------------------------------------------+
Меню
1) Печать
2) Бинарный поиск
3) Сортировка
4) Перемешивание
5) Реверс
6) Выход
Выберите действие
2
Введите ключ: 41f
Найдена строка:                ###############################
Меню
1) Печать
2) Бинарный поиск
3) Сортировка
4) Перемешивание
5) Реверс
6) Выход
Выберите действие
5
Меню
1) Печать
2) Бинарный поиск
3) Сортировка
4) Перемешивание
5) Реверс
6) Выход
Выберите действие
1
+-------+----------------------------------------------------------------------------------+
|  Ключ |                          Значение                                                |
+-------+----------------------------------------------------------------------------------+
|   41f |                     ###############################
|   40e |                ######                         ######

|   39d |              ####                                 ####

|   38c |             ##                                       ##

|   37b |            ##  #####################################  ##

|   36a |           ##   ## ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,, ##   ##

|   35z |           ###  ##                                 ##  ###

|   34y |            ### ##################################### ###

|   33x |             #####                                 #####

|   32w |                ##                                 ###

|   31v |                ##                                 ##

|   30u |                ##                                 ##

|   29t |                #####################################

|   28s |                ##                                 ##

|   27r |                ##                                 ##.

|   26q |                #####################################;

|   25p |                 .###################################

|   24o |                       #############################

|   23n |                           #######  ###############

|   22m |                                ##  #############

|   21l |                                ##  ##########

|   20k |                                ##  ##

|   19j |                                ##  ##

|   18i |                                ##  ##

|   17h |                                ######

|   16g |                                 #####

|   15f |                                  :

|   14e |                                ####

|   13d |                               ##  ##

|   12c |                                ## ##

| 11bcc |                                 ###

|  10ab |                                  #,

+-------+----------------------------------------------------------------------------------+
Меню
1) Печать
2) Бинарный поиск
3) Сортировка
4) Перемешивание
5) Реверс
6) Выход
Выберите действие
2
Ошибка. Таблица не отсортирована
Меню
1) Печать
2) Бинарный поиск
3) Сортировка
4) Перемешивание
5) Реверс
6) Выход
Выберите действие
4
Меню
1) Печать
2) Бинарный поиск
3) Сортировка
4) Перемешивание
5) Реверс
6) Выход
Выберите действие
2
Ошибка. Таблица не отсортирована
Меню
1) Печать
2) Бинарный поиск
3) Сортировка
4) Перемешивание
5) Реверс
6) Выход
Выберите действие
1
+-------+----------------------------------------------------------------------------------+
|  Ключ |                          Значение                                                |
+-------+----------------------------------------------------------------------------------+
|   41f |                     ###############################
|   18i |                                ##  ##

|   19j |                                ##  ##

|   37b |            ##  #####################################  ##

|   38c |             ##                                       ##

|   28s |                ##                                 ##

|   25p |                 .###################################

|   23n |                           #######  ###############

|   27r |                ##                                 ##.

|  10ab |                                  #,

|   20k |                                ##  ##

|   26q |                #####################################;

|   30u |                ##                                 ##

|   39d |              ####                                 ####

|   35z |           ###  ##                                 ##  ###

|   15f |                                  :

|   17h |                                ######

| 11bcc |                                 ###

|   21l |                                ##  ##########

|   31v |                ##                                 ##

|   22m |                                ##  #############

|   33x |             #####                                 #####

|   12c |                                ## ##

|   32w |                ##                                 ###

|   24o |                       #############################

|   29t |                #####################################

|   13d |                               ##  ##

|   40e |                ######                         ######

|   16g |                                 #####

|   14e |                                ####

|   36a |           ##   ## ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,, ##   ##

|   34y |            ### ##################################### ###

+-------+----------------------------------------------------------------------------------+
Меню
1) Печать
2) Бинарный поиск
3) Сортировка
4) Перемешивание
5) Реверс
6) Выход
Выберите действие
3
Меню
1) Печать
2) Бинарный поиск
3) Сортировка
4) Перемешивание
5) Реверс
6) Выход
Выберите действие
1
+-------+----------------------------------------------------------------------------------+
|  Ключ |                          Значение                                                |
+-------+----------------------------------------------------------------------------------+
|  10ab |                                  #,

| 11bcc |                                 ###

|   12c |                                ## ##

|   13d |                               ##  ##

|   14e |                                ####

|   15f |                                  :

|   16g |                                 #####

|   17h |                                ######

|   18i |                                ##  ##

|   19j |                                ##  ##

|   20k |                                ##  ##

|   21l |                                ##  ##########

|   22m |                                ##  #############

|   23n |                           #######  ###############

|   24o |                       #############################

|   25p |                 .###################################

|   26q |                #####################################;

|   27r |                ##                                 ##.

|   28s |                ##                                 ##

|   29t |                #####################################

|   30u |                ##                                 ##

|   31v |                ##                                 ##

|   32w |                ##                                 ###

|   33x |             #####                                 #####

|   34y |            ### ##################################### ###

|   35z |           ###  ##                                 ##  ###

|   36a |           ##   ## ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,, ##   ##

|   37b |            ##  #####################################  ##

|   38c |             ##                                       ##

|   39d |              ####                                 ####

|   40e |                ######                         ######

|   41f |                     ###############################
+-------+----------------------------------------------------------------------------------+

Меню
1) Печать
2) Бинарный поиск
3) Сортировка
4) Перемешивание
5) Реверс
6) Выход
Выберите действие
2
Введите ключ: 40e
Найдена строка:             ######                         ######

Меню
1) Печать
2) Бинарный поиск
3) Сортировка
4) Перемешивание
5) Реверс
6) Выход
Выберите действие
6
==48388==
==48388== HEAP SUMMARY:
==48388==     in use at exit: 0 bytes in 0 blocks
==48388==   total heap usage: 4 allocs, 4 frees, 6,616 bytes allocated
==48388==
==48388== All heap blocks were freed -- no leaks are possible
==48388==
==48388== For lists of detected and suppressed errors, rerun with: -s
==48388== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
hopeee@hopeeenad:~/repository/Lab/CP9$
```
8. **Вывод:** В процессе работы научились работать с таблицами, их сортировать и осуществлять поиск. Потренировались работать с динамическими структурами. В целом, работа понравилась, было интересно работать с нестандартным форматом. Было бы ещё интересней, если бы не пришлось спать по 2 часа ради того, чтобы хоть что-то успевать по учёбе :(  
Итог: 8/10.   
